<!DOCTYPE html>

<head>
    <title>WebSocket</title>
</head>
<body>
	<script>
       
        var onOpen=function(event){
        	console.log('Socket opened.readyState:'+socket.readyState);
        	var msg={
        		type:"message",
        		text:"something",
        		id:"number",
        		time:Date.now()
        	};
        	socket.send(JSON.stringify(msg));
        }

        var onClose=function(event){
        	console.log('Socket closed.readyState:'+socket.readyState);
        	console.log('Connected to:'+event.currentTarget.url);
        }

        var onMessage=function(event){
        	console.log("We get signal:");
        	console.log(date);
        	console.log('onMessageready:'+socket.readyState);
        }

        var onError=function(event){
        	console.log("We got an error.:"+event.data);
        }

		//创建WebSocket对象请求
		var socket=new WebSocket("ws://127.0.0.1:9578/");
		//相应监听事件
		socket.onopen=onOpen;
		socket.onclose=onClose;
		socket.onerror=onError;
		socket.onmessage=onMessage;

		//需要ws模块
		var WebSocketServer=require('ws').Server;

		//并创建wss服务器
		var wss=new WebSocketServer({port:9578});

		wss.on('connection',function(ws){
			ws.on('message',function(message){
				var obj=JSON.parse(message);
				console.log('received: %s',obj.time);
			)}
		)}
	</script>
</body>
</html>
